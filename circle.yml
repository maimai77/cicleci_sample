machine:
  ruby:
    version: 2.2.4
  environment:
    RAILS_ENV: test

checkout:
  post:
    - git clone git@github.com:redmine/redmine.git -b 3.2.3 redmine
    - cd redmine/plugins && ln -s ../../../circle_sample

dependencies:
  pre:
    - cd redmine && cp config/database.yml{.example,}
  override:
    - cd redmine && bundle install --without rmagick

database:
  override:
    - cd redmine && bin/rake db:create
    - cd redmine && bin/rake db:migrate
  post:
    - cd redmine && bin/rake redmine:plugins:migrate

test:
  override:
    - cd redmine && bin/rake redmine:plugins:test
